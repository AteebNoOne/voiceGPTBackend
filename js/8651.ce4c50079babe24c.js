"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8651],{8651:(Q,m,c)=>{c.r(m),c.d(m,{HomePageModule:()=>J});var d=c(6814),l=c(1929),b=c(95),u=c(1837),g=c(5861),_=c(2181),e=c(9212),p=c(3076),x=c(5619);let f=(()=>{var o;class r{constructor(t){this.userService=t,this.refreshSubject=new x.X(!1)}getUserMessages(){this.userService.getUserMessages().subscribe({next:t=>{this.refreshSubject.next(!0)},error:t=>{this.refreshSubject.next(!1)}})}getRefreshObservable(){return this.refreshSubject.asObservable()}}return(o=r).\u0275fac=function(t){return new(t||o)(e.LFG(p.K))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),r})();const v=["audioPlayer"];function C(o,r){if(1&o&&(e.TgZ(0,"div",5),e._UZ(1,"audio",6,7),e.qZA()),2&o){const n=e.oxw();e.xp6(1),e.Q6J("src",n.audioSrc,e.LSH)}}let M=(()=>{var o;class r{constructor(t){this.cdr=t,this.audioRecorded=new e.vpe,this.audioMessage="",this.isRecording=!1,this.chunks=[],this.audioSrc="",this.recordedBlob=""}toggleRecording(){var t=this;return(0,g.Z)(function*(){t.isRecording?t.stopRecording():yield t.startRecording(),t.isRecording=!t.isRecording})()}startRecording(){var t=this;return(0,g.Z)(function*(){const s=yield navigator.mediaDevices.getUserMedia({audio:!0});t.mediaRecorder=new MediaRecorder(s),t.mediaRecorder.ondataavailable=i=>{i.data.size>0&&t.chunks.push(i.data)},t.mediaRecorder.onstop=()=>{t.recordedBlob=new Blob(t.chunks,{type:"audio/wav"}),t.audioSrc=URL.createObjectURL(t.recordedBlob),t.cdr.detectChanges(),t.chunks=[]},t.mediaRecorder.start()})()}stopRecording(){this.mediaRecorder.stop()}sendAudioMessage(){this.audioRecorded.emit(this.recordedBlob),this.chunks=[],this.audioSrc=""}}return(o=r).\u0275fac=function(t){return new(t||o)(e.Y36(e.sBO))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-audio-input-bar"]],viewQuery:function(t,s){if(1&t&&e.Gf(v,5),2&t){let i;e.iGM(i=e.CRH())&&(s.audioPlayer=i.first)}},outputs:{audioRecorded:"audioRecorded"},decls:8,vars:5,consts:[["slot","start"],[3,"click"],["class","audio-container",4,"ngIf"],["slot","end"],[3,"disabled","click"],[1,"audio-container"],["controls","",3,"src"],["audioPlayer",""]],template:function(t,s){1&t&&(e.TgZ(0,"ion-toolbar")(1,"ion-buttons",0)(2,"ion-button",1),e.NdJ("click",function(){return s.toggleRecording()}),e._uU(3),e.qZA()(),e.YNc(4,C,3,1,"div",2),e.TgZ(5,"ion-buttons",3)(6,"ion-button",4),e.NdJ("click",function(){return s.sendAudioMessage()}),e._uU(7," Send "),e.qZA()()()),2&t&&(e.xp6(2),e.Tol(s.isRecording?"recording-btn":"start-btn"),e.xp6(1),e.hij(" ",s.isRecording?"Stop Recording":"Start Recording"," "),e.xp6(1),e.Q6J("ngIf",s.audioSrc),e.xp6(2),e.Q6J("disabled",!s.audioSrc||s.isRecording))},dependencies:[d.O5,l.YG,l.Sm,l.sr],styles:["ion-toolbar[_ngcontent-%COMP%]{display:flex;--background: #40cfa2;height:80px;border:3px solid #102921;border-radius:20px}.recording-btn[_ngcontent-%COMP%]{border-radius:10px;background-color:red;color:#000}.start-btn[_ngcontent-%COMP%]{border-radius:10px;background-color:green;color:#000}.audio-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:100%}"]}),r})();const y=["messagesContainer"];function T(o,r){if(1&o&&(e.TgZ(0,"div",8),e._uU(1),e.qZA()),2&o){const n=e.oxw(2);e.xp6(1),e.hij(" ",n.username," ")}}function P(o,r){1&o&&(e.TgZ(0,"div",9),e._uU(1," VoiceGPT "),e.qZA())}function O(o,r){if(1&o&&e._UZ(0,"audio",10),2&o){const n=e.oxw().$implicit;e.Q6J("src",n.audio,e.LSH)}}const w=(o,r)=>({"message-right":o,"message-left":r});function A(o,r){if(1&o&&(e.TgZ(0,"div",3)(1,"div",4),e.YNc(2,T,2,1,"div",5)(3,P,2,0,"div",6)(4,O,1,1,"audio",7),e.qZA()()),2&o){const n=r.$implicit;e.Q6J("ngClass",e.WLB(4,w,"message"===n.type,"response"===n.type)),e.xp6(2),e.Q6J("ngIf","message"===n.type),e.xp6(1),e.Q6J("ngIf","response"===n.type),e.xp6(1),e.Q6J("ngIf",n.audio)}}let R=(()=>{var o;class r{constructor(t,s){this.userService=t,this.userMessageService=s,this.chatData=[],this.username=""}ngOnInit(){this.getUserMessages(),this.userMessageService.getRefreshObservable().subscribe(t=>{t&&this.getUserMessages()})}getUserMessages(){this.userService.getUserMessages().subscribe({next:t=>{this.chatData=t.map(s=>({type:s.type,audio:s.audio,username:s.username}))},error:t=>{}})}}return(o=r).\u0275fac=function(t){return new(t||o)(e.Y36(p.K),e.Y36(f))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-messages"]],viewQuery:function(t,s){if(1&t&&e.Gf(y,5),2&t){let i;e.iGM(i=e.CRH())&&(s.messagesContainer=i.first)}},inputs:{chatData:"chatData",username:"username"},decls:3,vars:1,consts:[[1,"messages"],["messagesContainer",""],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"],[1,"message-container"],["class","you-label",4,"ngIf"],["class","gpt-label",4,"ngIf"],["controls","",3,"src",4,"ngIf"],[1,"you-label"],[1,"gpt-label"],["controls","",3,"src"]],template:function(t,s){1&t&&(e.TgZ(0,"div",0,1),e.YNc(2,A,5,7,"div",2),e.qZA()),2&t&&(e.xp6(2),e.Q6J("ngForOf",s.chatData))},dependencies:[d.mk,d.sg,d.O5],styles:[".messages[_ngcontent-%COMP%]{display:flex;flex-direction:column-reverse;width:100%;margin:auto;border:1px solid #ccc;padding:10px;overflow-y:auto;scroll-snap-type:y mandatory;overflow-anchor:none}.message-container[_ngcontent-%COMP%]{margin-top:30px;position:relative}.message-right[_ngcontent-%COMP%]{height:100px;text-align:right;margin-left:auto;background-color:#e1ffe1;padding:-20px;margin-bottom:5px;border-radius:5px}.message-left[_ngcontent-%COMP%]{text-align:left;margin-right:auto;background-color:#e1ffe1;padding:5px;margin-bottom:5px;border-radius:5px}.you-label[_ngcontent-%COMP%]{position:absolute;top:-20px;right:5px;font-weight:700}.gpt-label[_ngcontent-%COMP%]{position:absolute;top:-20px;left:5px;font-weight:700}"]}),r})();const S=(o,r)=>({success:o,error:r});function Z(o,r){if(1&o){const n=e.EpF();e.TgZ(0,"div",1)(1,"span",2),e.NdJ("click",function(){e.CHM(n);const s=e.oxw();return e.KtG(s.closeAlert())}),e._uU(2,"\xd7"),e.qZA(),e.TgZ(3,"p"),e._uU(4),e.qZA()()}if(2&o){const n=e.oxw();e.Q6J("ngClass",e.WLB(2,S,"success"===n.type,"error"===n.type)),e.xp6(4),e.Oqu(n.message)}}let k=(()=>{var o;class r{constructor(){this.type="success",this.message=""}closeAlert(){this.message=""}}return(o=r).\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-alert"]],inputs:{type:"type",message:"message"},decls:1,vars:1,consts:[["class","alert",3,"ngClass",4,"ngIf"],[1,"alert",3,"ngClass"],[1,"close-btn",3,"click"]],template:function(t,s){1&t&&e.YNc(0,Z,5,5,"div",0),2&t&&e.Q6J("ngIf",s.message)},dependencies:[d.mk,d.O5],styles:[".alert[_ngcontent-%COMP%]{padding:15px;margin-bottom:20px;border:1px solid;border-radius:4px;cursor:pointer}.success[_ngcontent-%COMP%]{background-color:#d4edda;color:#155724;border-color:#c3e6cb}.error[_ngcontent-%COMP%]{background-color:#f8d7da;color:#721c24;border-color:#f5c6cb}.close-btn[_ngcontent-%COMP%]{float:right;font-size:20px;font-weight:700;cursor:pointer}"],changeDetection:0}),r})();function I(o,r){1&o&&(e.TgZ(0,"div",14),e._UZ(1,"div",15),e.qZA())}function U(o,r){if(1&o){const n=e.EpF();e.TgZ(0,"ion-content",1),e.YNc(1,I,2,0,"div",2),e.TgZ(2,"div",3)(3,"div",4)(4,"div",5),e._UZ(5,"div",6),e.TgZ(6,"div",7)(7,"h2"),e._uU(8),e.qZA()()(),e.TgZ(9,"button",8),e.NdJ("click",function(){e.CHM(n);const s=e.oxw();return e.KtG(s.logoutFunction())}),e._uU(10,"Logout"),e.qZA()(),e.TgZ(11,"div",9),e._UZ(12,"app-alert",10),e.TgZ(13,"div",11),e._UZ(14,"app-messages",12),e.qZA(),e.TgZ(15,"app-audio-input-bar",13),e.NdJ("audioRecorded",function(s){e.CHM(n);const i=e.oxw();return e.KtG(i.onAudioRecorded(s))}),e.qZA()()()()}if(2&o){const n=e.oxw();e.Q6J("fullscreen",!0),e.xp6(1),e.Q6J("ngIf",n.loading),e.xp6(7),e.hij("Welcome ",n.username,""),e.xp6(4),e.Q6J("type",n.alertType)("message",n.alertMessage),e.xp6(2),e.Q6J("username",n.username)}}const B=[{path:"",component:(()=>{var o;class r{constructor(t,s,i,a){this.userService=t,this.router=s,this.cdr=i,this.userMessageService=a,this.loading=!1,this.showContent=!1,this.formData=new FormData,this.alertType="success",this.alertMessage="",this.jsonData={chat:[{type:"",audio:""}]},this.username=""}ngOnInit(){this.router.events.pipe((0,_.h)(t=>t instanceof u.m2)).subscribe(()=>{this.validateToken()}),this.startIdleTimeout()}validateToken(){this.userService.isAccessTokenExpired()?this.refreshToken():(this.resetIdleTimeout(),this.getUserInfo(),this.showContent=!0)}refreshToken(){this.userService.refreshAccessToken().subscribe({next:t=>{this.resetIdleTimeout(),this.showContent=!0},error:t=>{this.router.navigate(["/login"])}})}getUserInfo(){this.userService.getUserInfo().subscribe({next:t=>{this.username=t.username},error:t=>{}})}onAudioRecorded(t){var s=this;return(0,g.Z)(function*(){const i=URL.createObjectURL(t);try{const a=yield s.blobToBuffer(i);s.uploadAudio(a)}catch(a){console.error("Error converting blob to buffer:",a)}finally{URL.revokeObjectURL(i)}})()}uploadAudio(t){this.loading=!0,this.formData=new FormData;const i=`message_${(new Date).toISOString().replace(/[:.]/g,"-")}.wav`;this.formData.append("file",new Blob([t]),i),this.formData.append("username",this.username),this.userService.uploadAudio(this.formData).subscribe({next:a=>{this.userService.getResponse(i).subscribe({next:h=>{this.userMessageService.getUserMessages(),this.loading=!1},error:h=>{console.error("Error generating response:",h),this.loading=!1}})},error:a=>{console.error("Error uploading audio:",a),this.loading=!1}})}blobToBuffer(t){return new Promise((s,i)=>{fetch(t).then(a=>{if(a.ok)return a.arrayBuffer();i(new Error(`Failed to fetch blob: ${a.status} - ${a.statusText}`))}).then(a=>{a?s(a):i(new Error("ArrayBuffer is undefined."))}).catch(a=>{i(a)})})}resetIdleTimeout(){clearTimeout(this.idleTimeout),this.startIdleTimeout()}startIdleTimeout(){this.idleTimeout=setTimeout(()=>{this.router.navigate(["/login"])},9e5)}showSuccessAlert(){this.alertType="success",this.alertMessage="Audio sent, wait for response!",this.cdr.detectChanges()}logoutFunction(){localStorage.clear(),window.location.reload()}}return(o=r).\u0275fac=function(t){return new(t||o)(e.Y36(p.K),e.Y36(u.F0),e.Y36(e.sBO),e.Y36(f))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-home"]],decls:1,vars:1,consts:[[3,"fullscreen",4,"ngIf"],[3,"fullscreen"],["class","loader-container",4,"ngIf"],[1,"container"],[1,"sidebar"],[1,"user-info"],[1,"user-image"],[1,"user-details"],[1,"logoutButton",3,"click"],[1,"chat"],[3,"type","message"],[1,"messages"],[3,"username"],[1,"bottom-input",3,"audioRecorded"],[1,"loader-container"],[1,"loader"]],template:function(t,s){1&t&&e.YNc(0,U,16,6,"ion-content",0),2&t&&e.Q6J("ngIf",s.showContent)},dependencies:[d.O5,l.W2,M,R,k],styles:[".container[_ngcontent-%COMP%]{display:flex;height:100vh}.container[_ngcontent-%COMP%]   .sidebar[_ngcontent-%COMP%]{width:300px;background-color:#102921;padding:20px;box-shadow:0 4px 8px #0000001a;position:fixed;left:0;top:0;bottom:0;overflow-y:auto}.container[_ngcontent-%COMP%]   .sidebar[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]{display:flex;align-items:center}.container[_ngcontent-%COMP%]   .sidebar[_ngcontent-%COMP%]   .user-image[_ngcontent-%COMP%]{width:70px;height:60px;border-radius:50%;background-color:#3498db;margin-right:10px;border:1px solid black;box-shadow:0 0 14px 4px #fdfbfb2a}.container[_ngcontent-%COMP%]   .sidebar[_ngcontent-%COMP%]   .logoutButton[_ngcontent-%COMP%]{width:200px;height:50px;border-radius:10px;color:#fff;background-color:red;position:absolute;bottom:0;margin-bottom:50px;margin-left:auto;margin-right:auto}.container[_ngcontent-%COMP%]   .sidebar[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]{color:#fff}.chat[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin-left:300px;width:calc(100% - 300px);background-color:#358b70;padding:20px;box-shadow:0 4px 8px #0000001a;position:relative}.bottom-input[_ngcontent-%COMP%]{position:flex-end}.messages[_ngcontent-%COMP%]{height:80%;width:100%;margin-bottom:20px;overflow-y:auto}.loader-container[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#11020242;display:flex;align-items:center;justify-content:center;z-index:9999}.loader[_ngcontent-%COMP%]{width:50px;height:50px;border-radius:50%;border:8px solid #3498db;border-top:8px solid transparent;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}"]}),r})()}];let H=(()=>{var o;class r{}return(o=r).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[u.Bz.forChild(B),u.Bz]}),r})(),J=(()=>{var o;class r{}return(o=r).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[d.ez,b.u5,l.Pc,H]}),r})()}}]);